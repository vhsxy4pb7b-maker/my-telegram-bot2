# ä¿®å¤åˆ©æ¯æ”¶å…¥æŠ¥è¡¨å’Œæ˜ç»†ä¸ä¸€è‡´é—®é¢˜

## ğŸ” é—®é¢˜æè¿°

å½“æ—¥åˆ©æ¯æ”¶å…¥æŠ¥è¡¨æ˜¾ç¤ºçš„å€¼ä¸æ”¶å…¥æ˜ç»†æ˜¾ç¤ºçš„å€¼ä¸ä¸€è‡´ã€‚

## ğŸ“Š æ ¹æœ¬åŸå› 

### æ•°æ®æ¥æºä¸ä¸€è‡´

1. **æŠ¥è¡¨ä¸­çš„åˆ©æ¯æ”¶å…¥**ï¼š
   - æ•°æ®æºï¼š`daily_data` è¡¨çš„ `interest` å­—æ®µï¼ˆç»Ÿè®¡æ•°æ®ï¼‰
   - æŸ¥è¯¢æ–¹å¼ï¼š`get_stats_by_date_range()` â†’ `SUM(interest)`

2. **æ”¶å…¥æ˜ç»†ä¸­çš„åˆ©æ¯**ï¼š
   - æ•°æ®æºï¼š`income_records` è¡¨ä¸­ `type='interest'` çš„è®°å½•
   - æŸ¥è¯¢æ–¹å¼ï¼š`get_income_records(type='interest')` â†’ æ±‚å’Œ `amount` å­—æ®µ

### å¯èƒ½å¯¼è‡´ä¸ä¸€è‡´çš„æƒ…å†µ

1. **ç»Ÿè®¡æ›´æ–°æˆåŠŸï¼Œä½†æ˜ç»†è®°å½•å¤±è´¥**
   - ç»Ÿè®¡æ•°æ®å·²æ›´æ–°åˆ° `daily_data`
   - ä½† `income_records` è®°å½•å¤±è´¥ï¼ˆè¢« try-except æ•è·ï¼‰
   - ç»“æœï¼šæŠ¥è¡¨é‡‘é¢ > æ˜ç»†é‡‘é¢

2. **å†å²æ•°æ®ä¸ä¸€è‡´**
   - æ—§çš„åˆ©æ¯æ•°æ®æœ‰ç»Ÿè®¡ä½†æ²¡æœ‰æ˜ç»†è®°å½•
   - åœ¨æ”¶å…¥æ˜ç»†åŠŸèƒ½æ·»åŠ ä¹‹å‰çš„æ•°æ®
   - ç»“æœï¼šæŠ¥è¡¨é‡‘é¢ > æ˜ç»†é‡‘é¢

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ç»Ÿä¸€æ•°æ®æº

**ä¿®æ”¹æŠ¥è¡¨ç”Ÿæˆé€»è¾‘**ï¼šè®©æŠ¥è¡¨ä¸­çš„åˆ©æ¯æ”¶å…¥ä¹Ÿä» `income_records` è¡¨è®¡ç®—ï¼Œè€Œä¸æ˜¯ä» `daily_data` è¡¨è¯»å–ã€‚

è¿™æ ·ï¼š
- âœ… æŠ¥è¡¨å’Œæ˜ç»†ä½¿ç”¨ç›¸åŒçš„æ•°æ®æº
- âœ… æ•°æ®å®Œå…¨ä¸€è‡´
- âœ… æ”¶å…¥æ˜ç»†æ˜¯çœŸå®çš„è®°å½•ï¼Œæ›´å‡†ç¡®

### ä¿®å¤ä»£ç 

**æ–‡ä»¶**: `handlers/report_handlers.py`

**ä¿®æ”¹**: `generate_report_text()` å‡½æ•°

```python
# è·å–å‘¨æœŸç»Ÿè®¡æ•°æ®
stats = await db_operations.get_stats_by_date_range(
    start_date, end_date, group_id)

# ä»æ”¶å…¥æ˜ç»†è¡¨è·å–å®é™…åˆ©æ¯æ”¶å…¥ï¼ˆç¡®ä¿ä¸æ˜ç»†ä¸€è‡´ï¼‰
interest_records = await db_operations.get_income_records(
    start_date, end_date, type='interest', group_id=group_id)
actual_interest = sum(r['amount'] for r in interest_records)
# ä½¿ç”¨å®é™…æ”¶å…¥æ˜ç»†çš„åˆ©æ¯ï¼Œè€Œä¸æ˜¯ç»Ÿè®¡è¡¨çš„åˆ©æ¯
stats['interest'] = actual_interest
```

## ğŸ“Š ä¿®å¤æ•ˆæœ

| æ•°æ®é¡¹ | ä¿®å¤å‰ | ä¿®å¤å |
|--------|--------|--------|
| æŠ¥è¡¨åˆ©æ¯æ¥æº | `daily_data.interest` | `income_records` èšåˆ |
| æ˜ç»†åˆ©æ¯æ¥æº | `income_records` èšåˆ | `income_records` èšåˆ |
| æ•°æ®ä¸€è‡´æ€§ | âŒ å¯èƒ½ä¸ä¸€è‡´ | âœ… å®Œå…¨ä¸€è‡´ |

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å…¶ä»–å­—æ®µä¿æŒä¸å˜**ï¼šå…¶ä»–ç»Ÿè®¡å­—æ®µï¼ˆå®Œæˆè®¢å•ã€è¿çº¦è®¢å•ç­‰ï¼‰ä»ä» `daily_data` è¯»å–
2. **æ€§èƒ½å½±å“**ï¼šéœ€è¦æŸ¥è¯¢ `income_records` è¡¨ï¼Œä½†å¯¹äºå•æ—¥æŸ¥è¯¢å½±å“å¾ˆå°
3. **å‘åå…¼å®¹**ï¼šä¿®å¤ä¸å½±å“å…¶ä»–åŠŸèƒ½ï¼Œåªæ”¹å˜åˆ©æ¯æ”¶å…¥çš„æ˜¾ç¤ºæ–¹å¼

## ğŸ¯ ä¼˜åŠ¿

1. **æ•°æ®ä¸€è‡´æ€§**ï¼šæŠ¥è¡¨å’Œæ˜ç»†å®Œå…¨ä¸€è‡´
2. **çœŸå®æ•°æ®**ï¼šåŸºäºå®é™…è®°å½•ï¼Œæ›´å‡†ç¡®
3. **æ˜“äºç»´æŠ¤**ï¼šå•ä¸€æ•°æ®æºï¼Œå‡å°‘ä¸ä¸€è‡´é£é™©

---

**æ›´æ–°æ—¥æœŸ**: 2025-12-02  
**çŠ¶æ€**: âœ… å·²ä¿®å¤

